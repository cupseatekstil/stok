<script>
    // --- FIREBASE AYARLARI ---
    // Buradaki bilgileri kendi Firebase panelinden alıp yapıştır abi.
    const firebaseConfig = {
        apiKey: "API_KEY_BURAYA",
        authDomain: "PROJECT_ID.firebaseapp.com",
        databaseURL: "https://PROJECT_ID-default-rtdb.firebaseio.com",
        projectId: "PROJECT_ID",
        storageBucket: "PROJECT_ID.appspot.com",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID"
    };

    // Firebase Başlatma
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database();

    // KAYDET BUTONU FONKSİYONU
    function saveProduct() {
        console.log("Kaydet butonuna basıldı..."); // Kontrol için

        // Formdaki verileri alıyoruz
        const barcode = document.getElementById('newBarcode').value.trim();
        const name = document.getElementById('newName').value.trim();
        const category = document.getElementById('newCategory').value;
        const cost = document.getElementById('newCost').value;
        const stock = document.getElementById('newStock').value;
        const size = document.getElementById('newSize').value;
        const minStock = document.getElementById('newMinStock').value;

        // Boş alan kontrolü
        if (!barcode || !name || !category || !cost) {
            alert("Lütfen zorunlu alanları (Barkod, İsim, Kategori, Maliyet) doldurun!");
            return;
        }

        // Veri objesini oluşturuyoruz
        const productData = {
            barcode: barcode,
            name: name,
            category: category,
            cost: parseFloat(cost) || 0,
            stock: parseInt(stock) || 0,
            size: size || "",
            minStock: parseInt(minStock) || 5,
            image: productImage || "" // Eğer fotoğraf seçildiyse
        };

        // Firebase'e yazma işlemi
        db.ref('products/' + barcode).set(productData)
            .then(() => {
                alert("Ürün başarıyla kaydedildi! ✅");
                // Formu temizle
                document.getElementById('newBarcode').value = "";
                document.getElementById('newName').value = "";
                document.getElementById('newCost').value = "";
                productImage = null;
                document.getElementById('imagePreview').classList.add('hidden');
                // Ana ekrana dön
                showScreen('main');
            })
            .catch((error) => {
                alert("Hata oluştu: " + error.message);
                console.error("Firebase Hatası:", error);
            });
    }

    // Fotoğraf önizleme fonksiyonu
    function previewImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                productImage = e.target.result;
                const preview = document.getElementById('imagePreview');
                preview.src = productImage;
                preview.classList.remove('hidden');
                document.getElementById('uploadPlaceholder').classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }
    }
</script>
